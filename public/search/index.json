[{"content":"XXL-JOB\rXXL-JOBä»‹ç»\rXXL-JOBæ˜¯ä¸€ä¸ªè½»é‡çº§åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦å¹³å°ï¼Œå…¶æ ¸å¿ƒè®¾è®¡æ˜¯å¼€å‘è¿…é€Ÿã€å­¦ä¹ ç®€å•ã€è½»é‡çº§ã€æ˜“æ‰©å±•ï¼Œç°å·²å¼€æ”¾æºä»£ç å¹¶æ¥å…¥å¤šå®¶å…¬å¸çº¿ä¸Šäº§å“çº¿ï¼Œå¼€ç®±å³ç”¨\nå®˜ç½‘ï¼šhttps://www.xuxueli.com/xxl-job/\nXXL-JOBä¸»è¦ç”±è°ƒåº¦ä¸­å¿ƒã€æ‰§è¡Œå™¨ã€ä»»åŠ¡\nè°ƒåº¦ä¸­å¿ƒ è´Ÿè´£ç®¡ç†è°ƒåº¦ä¿¡æ¯ï¼ŒæŒ‰ç…§è°ƒåº¦é…ç½®å‘å‡ºè°ƒåº¦è¯·æ±‚ï¼Œè‡ªèº«ä¸æ‰¿æ‹…ä¸šåŠ¡ä»£ç  ä¸»è¦èŒè´£ä¸ºæ‰§è¡Œå™¨ç®¡ç†ã€ä»»åŠ¡ç®¡ç†ã€ç›‘æ§è¿ç»´ã€æ—¥å¿—ç®¡ç†ç­‰ ä»»åŠ¡æ‰§è¡Œå™¨ è´Ÿè´£æ¥æ”¶è°ƒåº¦è¯·æ±‚å¹¶æ‰§è¡Œä»»åŠ¡é€»è¾‘ ä¸»è¦èŒè´£æ˜¯æ³¨å†ŒæœåŠ¡ã€ä»»åŠ¡æ‰§è¡ŒæœåŠ¡ï¼ˆæ¥æ”¶åˆ°ä»»åŠ¡åä¼šæ”¾å…¥çº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡é˜Ÿåˆ—ï¼‰ã€æ‰§è¡Œç»“æœä¸ŠæŠ¥ã€æ—¥å¿—æœåŠ¡ç­‰ ä»»åŠ¡ è´Ÿè´£æ‰§è¡Œå…·ä½“çš„ä¸šåŠ¡é€»è¾‘ è°ƒåº¦ä¸­å¿ƒä¸æ‰§è¡Œå™¨ä¹‹é—´çš„å·¥ä½œæµç¨‹å¦‚ä¸‹ æ‰§è¡Œæµç¨‹\nä»»åŠ¡æ‰§è¡Œå™¨æ ¹æ®é…ç½®çš„è°ƒåº¦ä¸­å¿ƒçš„åœ°å€ï¼Œè‡ªåŠ¨æ³¨å†Œåˆ°è°ƒåº¦ä¸­å¿ƒ è¾¾åˆ°ä»»åŠ¡å‡ºå‘æ¡ä»¶ï¼Œè°ƒåº¦ä¸­å¿ƒä¸‹å‘ä»»åŠ¡ æ‰§è¡Œå™¨åŸºäºçº¿ç¨‹æ± æ‰§è¡Œä»»åŠ¡ï¼Œå¹¶æŠŠæ‰§è¡Œç»“æœæ”¾å…¥å†…å­˜é˜Ÿåˆ—ã€æŠŠæ‰§è¡Œæ—¥å¿—å†™å…¥æ—¥å¿—æ–‡ä»¶ä¸­ æ‰§è¡Œå™¨æ¶ˆè´¹å†…å­˜é˜Ÿåˆ—ä¸­çš„æ‰§è¡Œç»“æœï¼Œä¸»åŠ¨ä¸ŠæŠ¥ç»™è°ƒåº¦ä¸­å¿ƒ å½“ç”¨æˆ·åœ¨è°ƒåº¦ä¸­å¿ƒæŸ¥çœ‹ä»»åŠ¡æ—¥å¿—ï¼Œè°ƒåº¦ä¸­å¿ƒè¯·æ±‚ä»»åŠ¡æ‰§è¡Œå™¨ï¼Œä»»åŠ¡æ‰§è¡Œå™¨è¯»å–ä»»åŠ¡æ—¥å¿—æ–‡ä»¶å¹¶è¿”å›æ—¥å¿—è¯¦æƒ… åˆ©ç”¨dockeræ­å»ºXXL-JOB\rdocketå‘½ä»¤\rdocker search xxl-job æŸ¥çœ‹xxl-job docker pull xuxueli/xxl-job-admin:2.4.0 æ‹‰å– 2.4.0ç‰ˆæœ¬ docker run -d \\ -p 8088:8088 \\ -v /tool/xxl-job/logs:/data/applogs \\ -v /tool/xxl-job/application.properties:/xxl-job/xxl-job-admin/src/main/resources/application.properties \\ -e SPRING_DATASOURCE_URL=\u0026#39;jdbc:mysql://192.168.75.130:3306/xxl_job?useUnicode=true\u0026amp;characterEncoding=UTF-8\u0026amp;autoReconnect=true\u0026amp;serverTimezone=Asia/Shanghai\u0026#39; \\ -e SPRING_DATASOURCE_USERNAME=root \\ -e SPRING_DATASOURCE_PASSWORD=123456 \\ xuxueli/xxl-job-admin:2.4.0 åˆ›å»ºxxl_jobæ•°æ®åº“\rCREATE database if NOT EXISTS `xxl_job` default character set utf8mb4 collate utf8mb4_unicode_ci; use `xxl_job`; SET NAMES utf8mb4; CREATE TABLE `xxl_job_info` ( `id` int(11) NOT NULL AUTO_INCREMENT, `job_group` int(11) NOT NULL COMMENT \u0026#39;æ‰§è¡Œå™¨ä¸»é”®ID\u0026#39;, `job_desc` varchar(255) NOT NULL, `add_time` datetime DEFAULT NULL, `update_time` datetime DEFAULT NULL, `author` varchar(64) DEFAULT NULL COMMENT \u0026#39;ä½œè€…\u0026#39;, `alarm_email` varchar(255) DEFAULT NULL COMMENT \u0026#39;æŠ¥è­¦é‚®ä»¶\u0026#39;, `schedule_type` varchar(50) NOT NULL DEFAULT \u0026#39;NONE\u0026#39; COMMENT \u0026#39;è°ƒåº¦ç±»å‹\u0026#39;, `schedule_conf` varchar(128) DEFAULT NULL COMMENT \u0026#39;è°ƒåº¦é…ç½®ï¼Œå€¼å«ä¹‰å–å†³äºè°ƒåº¦ç±»å‹\u0026#39;, `misfire_strategy` varchar(50) NOT NULL DEFAULT \u0026#39;DO_NOTHING\u0026#39; COMMENT \u0026#39;è°ƒåº¦è¿‡æœŸç­–ç•¥\u0026#39;, `executor_route_strategy` varchar(50) DEFAULT NULL COMMENT \u0026#39;æ‰§è¡Œå™¨è·¯ç”±ç­–ç•¥\u0026#39;, `executor_handler` varchar(255) DEFAULT NULL COMMENT \u0026#39;æ‰§è¡Œå™¨ä»»åŠ¡handler\u0026#39;, `executor_param` varchar(512) DEFAULT NULL COMMENT \u0026#39;æ‰§è¡Œå™¨ä»»åŠ¡å‚æ•°\u0026#39;, `executor_block_strategy` varchar(50) DEFAULT NULL COMMENT \u0026#39;é˜»å¡å¤„ç†ç­–ç•¥\u0026#39;, `executor_timeout` int(11) NOT NULL DEFAULT \u0026#39;0\u0026#39; COMMENT \u0026#39;ä»»åŠ¡æ‰§è¡Œè¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’\u0026#39;, `executor_fail_retry_count` int(11) NOT NULL DEFAULT \u0026#39;0\u0026#39; COMMENT \u0026#39;å¤±è´¥é‡è¯•æ¬¡æ•°\u0026#39;, `glue_type` varchar(50) NOT NULL COMMENT \u0026#39;GLUEç±»å‹\u0026#39;, `glue_source` mediumtext COMMENT \u0026#39;GLUEæºä»£ç \u0026#39;, `glue_remark` varchar(128) DEFAULT NULL COMMENT \u0026#39;GLUEå¤‡æ³¨\u0026#39;, `glue_updatetime` datetime DEFAULT NULL COMMENT \u0026#39;GLUEæ›´æ–°æ—¶é—´\u0026#39;, `child_jobid` varchar(255) DEFAULT NULL COMMENT \u0026#39;å­ä»»åŠ¡IDï¼Œå¤šä¸ªé€—å·åˆ†éš”\u0026#39;, `trigger_status` tinyint(4) NOT NULL DEFAULT \u0026#39;0\u0026#39; COMMENT \u0026#39;è°ƒåº¦çŠ¶æ€ï¼š0-åœæ­¢ï¼Œ1-è¿è¡Œ\u0026#39;, `trigger_last_time` bigint(13) NOT NULL DEFAULT \u0026#39;0\u0026#39; COMMENT \u0026#39;ä¸Šæ¬¡è°ƒåº¦æ—¶é—´\u0026#39;, `trigger_next_time` bigint(13) NOT NULL DEFAULT \u0026#39;0\u0026#39; COMMENT \u0026#39;ä¸‹æ¬¡è°ƒåº¦æ—¶é—´\u0026#39;, PRIMARY KEY (`id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4; CREATE TABLE `xxl_job_log` ( `id` bigint(20) NOT NULL AUTO_INCREMENT, `job_group` int(11) NOT NULL COMMENT \u0026#39;æ‰§è¡Œå™¨ä¸»é”®ID\u0026#39;, `job_id` int(11) NOT NULL COMMENT \u0026#39;ä»»åŠ¡ï¼Œä¸»é”®ID\u0026#39;, `executor_address` varchar(255) DEFAULT NULL COMMENT \u0026#39;æ‰§è¡Œå™¨åœ°å€ï¼Œæœ¬æ¬¡æ‰§è¡Œçš„åœ°å€\u0026#39;, `executor_handler` varchar(255) DEFAULT NULL COMMENT \u0026#39;æ‰§è¡Œå™¨ä»»åŠ¡handler\u0026#39;, `executor_param` varchar(512) DEFAULT NULL COMMENT \u0026#39;æ‰§è¡Œå™¨ä»»åŠ¡å‚æ•°\u0026#39;, `executor_sharding_param` varchar(20) DEFAULT NULL COMMENT \u0026#39;æ‰§è¡Œå™¨ä»»åŠ¡åˆ†ç‰‡å‚æ•°ï¼Œæ ¼å¼å¦‚ 1/2\u0026#39;, `executor_fail_retry_count` int(11) NOT NULL DEFAULT \u0026#39;0\u0026#39; COMMENT \u0026#39;å¤±è´¥é‡è¯•æ¬¡æ•°\u0026#39;, `trigger_time` datetime DEFAULT NULL COMMENT \u0026#39;è°ƒåº¦-æ—¶é—´\u0026#39;, `trigger_code` int(11) NOT NULL COMMENT \u0026#39;è°ƒåº¦-ç»“æœ\u0026#39;, `trigger_msg` text COMMENT \u0026#39;è°ƒåº¦-æ—¥å¿—\u0026#39;, `handle_time` datetime DEFAULT NULL COMMENT \u0026#39;æ‰§è¡Œ-æ—¶é—´\u0026#39;, `handle_code` int(11) NOT NULL COMMENT \u0026#39;æ‰§è¡Œ-çŠ¶æ€\u0026#39;, `handle_msg` text COMMENT \u0026#39;æ‰§è¡Œ-æ—¥å¿—\u0026#39;, `alarm_status` tinyint(4) NOT NULL DEFAULT \u0026#39;0\u0026#39; COMMENT \u0026#39;å‘Šè­¦çŠ¶æ€ï¼š0-é»˜è®¤ã€1-æ— éœ€å‘Šè­¦ã€2-å‘Šè­¦æˆåŠŸã€3-å‘Šè­¦å¤±è´¥\u0026#39;, PRIMARY KEY (`id`), KEY `I_trigger_time` (`trigger_time`), KEY `I_handle_code` (`handle_code`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4; CREATE TABLE `xxl_job_log_report` ( `id` int(11) NOT NULL AUTO_INCREMENT, `trigger_day` datetime DEFAULT NULL COMMENT \u0026#39;è°ƒåº¦-æ—¶é—´\u0026#39;, `running_count` int(11) NOT NULL DEFAULT \u0026#39;0\u0026#39; COMMENT \u0026#39;è¿è¡Œä¸­-æ—¥å¿—æ•°é‡\u0026#39;, `suc_count` int(11) NOT NULL DEFAULT \u0026#39;0\u0026#39; COMMENT \u0026#39;æ‰§è¡ŒæˆåŠŸ-æ—¥å¿—æ•°é‡\u0026#39;, `fail_count` int(11) NOT NULL DEFAULT \u0026#39;0\u0026#39; COMMENT \u0026#39;æ‰§è¡Œå¤±è´¥-æ—¥å¿—æ•°é‡\u0026#39;, `update_time` datetime DEFAULT NULL, PRIMARY KEY (`id`), UNIQUE KEY `i_trigger_day` (`trigger_day`) USING BTREE ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4; CREATE TABLE `xxl_job_logglue` ( `id` int(11) NOT NULL AUTO_INCREMENT, `job_id` int(11) NOT NULL COMMENT \u0026#39;ä»»åŠ¡ï¼Œä¸»é”®ID\u0026#39;, `glue_type` varchar(50) DEFAULT NULL COMMENT \u0026#39;GLUEç±»å‹\u0026#39;, `glue_source` mediumtext COMMENT \u0026#39;GLUEæºä»£ç \u0026#39;, `glue_remark` varchar(128) NOT NULL COMMENT \u0026#39;GLUEå¤‡æ³¨\u0026#39;, `add_time` datetime DEFAULT NULL, `update_time` datetime DEFAULT NULL, PRIMARY KEY (`id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4; CREATE TABLE `xxl_job_registry` ( `id` int(11) NOT NULL AUTO_INCREMENT, `registry_group` varchar(50) NOT NULL, `registry_key` varchar(255) NOT NULL, `registry_value` varchar(255) NOT NULL, `update_time` datetime DEFAULT NULL, PRIMARY KEY (`id`), KEY `i_g_k_v` (`registry_group`,`registry_key`,`registry_value`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4; CREATE TABLE `xxl_job_group` ( `id` int(11) NOT NULL AUTO_INCREMENT, `app_name` varchar(64) NOT NULL COMMENT \u0026#39;æ‰§è¡Œå™¨AppName\u0026#39;, `title` varchar(12) NOT NULL COMMENT \u0026#39;æ‰§è¡Œå™¨åç§°\u0026#39;, `address_type` tinyint(4) NOT NULL DEFAULT \u0026#39;0\u0026#39; COMMENT \u0026#39;æ‰§è¡Œå™¨åœ°å€ç±»å‹ï¼š0=è‡ªåŠ¨æ³¨å†Œã€1=æ‰‹åŠ¨å½•å…¥\u0026#39;, `address_list` text COMMENT \u0026#39;æ‰§è¡Œå™¨åœ°å€åˆ—è¡¨ï¼Œå¤šåœ°å€é€—å·åˆ†éš”\u0026#39;, `update_time` datetime DEFAULT NULL, PRIMARY KEY (`id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4; CREATE TABLE `xxl_job_user` ( `id` int(11) NOT NULL AUTO_INCREMENT, `username` varchar(50) NOT NULL COMMENT \u0026#39;è´¦å·\u0026#39;, `password` varchar(50) NOT NULL COMMENT \u0026#39;å¯†ç \u0026#39;, `role` tinyint(4) NOT NULL COMMENT \u0026#39;è§’è‰²ï¼š0-æ™®é€šç”¨æˆ·ã€1-ç®¡ç†å‘˜\u0026#39;, `permission` varchar(255) DEFAULT NULL COMMENT \u0026#39;æƒé™ï¼šæ‰§è¡Œå™¨IDåˆ—è¡¨ï¼Œå¤šä¸ªé€—å·åˆ†å‰²\u0026#39;, PRIMARY KEY (`id`), UNIQUE KEY `i_username` (`username`) USING BTREE ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4; CREATE TABLE `xxl_job_lock` ( `lock_name` varchar(50) NOT NULL COMMENT \u0026#39;é”åç§°\u0026#39;, PRIMARY KEY (`lock_name`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4; INSERT INTO `xxl_job_group`(`id`, `app_name`, `title`, `address_type`, `address_list`, `update_time`) VALUES (1, \u0026#39;xxl-job-executor-sample\u0026#39;, \u0026#39;ç¤ºä¾‹æ‰§è¡Œå™¨\u0026#39;, 0, NULL, \u0026#39;2018-11-03 22:21:31\u0026#39; ); INSERT INTO `xxl_job_info`(`id`, `job_group`, `job_desc`, `add_time`, `update_time`, `author`, `alarm_email`, `schedule_type`, `schedule_conf`, `misfire_strategy`, `executor_route_strategy`, `executor_handler`, `executor_param`, `executor_block_strategy`, `executor_timeout`, `executor_fail_retry_count`, `glue_type`, `glue_source`, `glue_remark`, `glue_updatetime`, `child_jobid`) VALUES (1, 1, \u0026#39;æµ‹è¯•ä»»åŠ¡1\u0026#39;, \u0026#39;2018-11-03 22:21:31\u0026#39;, \u0026#39;2018-11-03 22:21:31\u0026#39;, \u0026#39;XXL\u0026#39;, \u0026#39;\u0026#39;, \u0026#39;CRON\u0026#39;, \u0026#39;0 0 0 * * ? *\u0026#39;, \u0026#39;DO_NOTHING\u0026#39;, \u0026#39;FIRST\u0026#39;, \u0026#39;demoJobHandler\u0026#39;, \u0026#39;\u0026#39;, \u0026#39;SERIAL_EXECUTION\u0026#39;, 0, 0, \u0026#39;BEAN\u0026#39;, \u0026#39;\u0026#39;, \u0026#39;GLUEä»£ç åˆå§‹åŒ–\u0026#39;, \u0026#39;2018-11-03 22:21:31\u0026#39;, \u0026#39;\u0026#39;); INSERT INTO `xxl_job_user`(`id`, `username`, `password`, `role`, `permission`) VALUES (1, \u0026#39;admin\u0026#39;, \u0026#39;e10adc3949ba59abbe56e057f20f883e\u0026#39;, 1, NULL); INSERT INTO `xxl_job_lock` ( `lock_name`) VALUES ( \u0026#39;schedule_lock\u0026#39;); ç½‘ç«™ç™»å½•\ræ ¹æ®æ•°æ®åº“è„šæœ¬åˆ›å»ºæ•°æ®åº“ï¼Œä¿®æ”¹æ•°æ®åº“è¿æ¥ä¿¡æ¯å’Œç«¯å£ï¼Œå¯åŠ¨xxl-job-adminï¼Œè®¿é—®http://local:18088/xxl-job-admin/\nè´¦å·å¯†ç ï¼šadmin/123456 javaè¿æ¥xxl-job\ræ·»åŠ ä¾èµ–\rï¼ˆçˆ¶å·¥ç¨‹ä¸­å®Œæˆäº†ç‰ˆæœ¬æ§åˆ¶ï¼Œè¿™é‡Œçš„ç‰ˆæœ¬æ˜¯2.4.0ï¼‰\nXML \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.xuxueli\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;xxl-job-core\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; yamlæ–‡ä»¶æ·»åŠ \rxxl: job: admin: addresses: http://...........:8088/xxl-job-admin/ #... æ›´æ¢æœåŠ¡å™¨åœ°å€ executor: appname: media-process-service #æ‰§è¡Œå™¨åå­— address: ip: port: 9999 logpath: /data/applogs/xxl-job-jobhandler logretentiondays: 30 accessToken: default_token é…ç½®xxl-jobçš„æ‰§è¡Œå™¨\rå°†ç¤ºä¾‹å·¥ç¨‹ä¸‹çš„é…ç½®ç±»æ‹·è´åˆ°media-serviceå·¥ç¨‹ä¸‹ï¼Œè¯¥ç±»ä¸­çš„å±æ€§å°±æ˜¯è·å–é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®å¾—åˆ°çš„ï¼ŒåŒæ—¶æä¾›äº†ä¸€ä¸ªæ‰§è¡Œå™¨çš„Bean JAVA @Configuration public class XxlJobConfig { private Logger logger = LoggerFactory.getLogger(XxlJobConfig.class); @Value(\u0026#34;${xxl.job.admin.addresses}\u0026#34;) private String adminAddresses; @Value(\u0026#34;${xxl.job.accessToken}\u0026#34;) private String accessToken; @Value(\u0026#34;${xxl.job.executor.appname}\u0026#34;) private String appname; @Value(\u0026#34;${xxl.job.executor.address}\u0026#34;) private String address; @Value(\u0026#34;${xxl.job.executor.ip}\u0026#34;) private String ip; @Value(\u0026#34;${xxl.job.executor.port}\u0026#34;) private int port; @Value(\u0026#34;${xxl.job.executor.logpath}\u0026#34;) private String logPath; @Value(\u0026#34;${xxl.job.executor.logretentiondays}\u0026#34;) private int logRetentionDays; @Bean public XxlJobSpringExecutor xxlJobExecutor() { logger.info(\u0026#34;\u0026gt;\u0026gt;\u0026gt;\u0026gt;\u0026gt;\u0026gt;\u0026gt;\u0026gt;\u0026gt;\u0026gt;\u0026gt; xxl-job config init.\u0026#34;); XxlJobSpringExecutor xxlJobSpringExecutor = new XxlJobSpringExecutor(); xxlJobSpringExecutor.setAdminAddresses(adminAddresses); xxlJobSpringExecutor.setAppname(appname); xxlJobSpringExecutor.setAddress(address); xxlJobSpringExecutor.setIp(ip); xxlJobSpringExecutor.setPort(port); xxlJobSpringExecutor.setAccessToken(accessToken); xxlJobSpringExecutor.setLogPath(logPath); xxlJobSpringExecutor.setLogRetentionDays(logRetentionDays); return xxlJobSpringExecutor; } /** * é’ˆå¯¹å¤šç½‘å¡ã€å®¹å™¨å†…éƒ¨ç½²ç­‰æƒ…å†µï¼Œå¯å€ŸåŠ© \u0026#34;spring-cloud-commons\u0026#34; æä¾›çš„ \u0026#34;InetUtils\u0026#34; ç»„ä»¶çµæ´»å®šåˆ¶æ³¨å†ŒIPï¼› * * 1ã€å¼•å…¥ä¾èµ–ï¼š * \u0026lt;dependency\u0026gt; * \u0026lt;groupId\u0026gt;org.springframework.cloud\u0026lt;/groupId\u0026gt; * \u0026lt;artifactId\u0026gt;spring-cloud-commons\u0026lt;/artifactId\u0026gt; * \u0026lt;version\u0026gt;${version}\u0026lt;/version\u0026gt; * \u0026lt;/dependency\u0026gt; * * 2ã€é…ç½®æ–‡ä»¶ï¼Œæˆ–è€…å®¹å™¨å¯åŠ¨å˜é‡ * spring.cloud.inetutils.preferred-networks: \u0026#39;xxx.xxx.xxx.\u0026#39; * * 3ã€è·å–IP * String ip_ = inetUtils.findFirstNonLoopbackHostInfo().getIpAddress(); */ } è¿›å…¥è°ƒåº¦ä¸­å¿ƒï¼Œæ·»åŠ æ‰§è¡Œå™¨\ré‡å¯ï¼Œå¯ä»¥çœ‹åˆ°æ‰§è¡Œå™¨åœ¨è°ƒå…¥ä¸­å¿ƒæ³¨å†ŒæˆåŠŸ\ræ‰§è¡Œä»»åŠ¡\rä¸‹é¢ç¼–å†™ä»»åŠ¡ï¼Œä»»åŠ¡ç±»çš„ç¼–å†™æ–¹æ³•å‚è€ƒç¤ºä¾‹å·¥ç¨‹ JAVA package com.xxl.job.executor.service.jobhandler; import com.xxl.job.core.context.XxlJobHelper; import com.xxl.job.core.handler.annotation.XxlJob; import org.slf4j.Logger; import org.slf4j.LoggerFactory; import org.springframework.stereotype.Component; import java.io.BufferedInputStream; import java.io.BufferedReader; import java.io.DataOutputStream; import java.io.InputStreamReader; import java.net.HttpURLConnection; import java.net.URL; import java.util.Arrays; import java.util.concurrent.TimeUnit; /** * XxlJobå¼€å‘ç¤ºä¾‹ï¼ˆBeanæ¨¡å¼ï¼‰ * * å¼€å‘æ­¥éª¤ï¼š * 1ã€ä»»åŠ¡å¼€å‘ï¼šåœ¨Spring Beanå®ä¾‹ä¸­ï¼Œå¼€å‘Jobæ–¹æ³•ï¼› * 2ã€æ³¨è§£é…ç½®ï¼šä¸ºJobæ–¹æ³•æ·»åŠ æ³¨è§£ \u0026#34;@XxlJob(value=\u0026#34;è‡ªå®šä¹‰jobhandleråç§°\u0026#34;, init = \u0026#34;JobHandleråˆå§‹åŒ–æ–¹æ³•\u0026#34;, destroy = \u0026#34;JobHandleré”€æ¯æ–¹æ³•\u0026#34;)\u0026#34;ï¼Œæ³¨è§£valueå€¼å¯¹åº”çš„æ˜¯è°ƒåº¦ä¸­å¿ƒæ–°å»ºä»»åŠ¡çš„JobHandlerå±æ€§çš„å€¼ã€‚ * 3ã€æ‰§è¡Œæ—¥å¿—ï¼šéœ€è¦é€šè¿‡ \u0026#34;XxlJobHelper.log\u0026#34; æ‰“å°æ‰§è¡Œæ—¥å¿—ï¼› * 4ã€ä»»åŠ¡ç»“æœï¼šé»˜è®¤ä»»åŠ¡ç»“æœä¸º \u0026#34;æˆåŠŸ\u0026#34; çŠ¶æ€ï¼Œä¸éœ€è¦ä¸»åŠ¨è®¾ç½®ï¼›å¦‚æœ‰è¯‰æ±‚ï¼Œæ¯”å¦‚è®¾ç½®ä»»åŠ¡ç»“æœä¸ºå¤±è´¥ï¼Œå¯ä»¥é€šè¿‡ \u0026#34;XxlJobHelper.handleFail/handleSuccess\u0026#34; è‡ªä¸»è®¾ç½®ä»»åŠ¡ç»“æœï¼› * * @author xuxueli 2019-12-11 21:52:51 */ @Component public class SampleXxlJob { private static Logger logger = LoggerFactory.getLogger(SampleXxlJob.class); /** * 1ã€ç®€å•ä»»åŠ¡ç¤ºä¾‹ï¼ˆBeanæ¨¡å¼ï¼‰ */ @XxlJob(\u0026#34;demoJobHandler\u0026#34;) public void demoJobHandler() throws Exception { XxlJobHelper.log(\u0026#34;XXL-JOB, Hello World.\u0026#34;); for (int i = 0; i \u0026lt; 5; i++) { XxlJobHelper.log(\u0026#34;beat at:\u0026#34; + i); TimeUnit.SECONDS.sleep(2); } // default success } /** * 2ã€åˆ†ç‰‡å¹¿æ’­ä»»åŠ¡ */ @XxlJob(\u0026#34;shardingJobHandler\u0026#34;) public void shardingJobHandler() throws Exception { // åˆ†ç‰‡å‚æ•° int shardIndex = XxlJobHelper.getShardIndex(); int shardTotal = XxlJobHelper.getShardTotal(); XxlJobHelper.log(\u0026#34;åˆ†ç‰‡å‚æ•°ï¼šå½“å‰åˆ†ç‰‡åºå· = {}, æ€»åˆ†ç‰‡æ•° = {}\u0026#34;, shardIndex, shardTotal); // ä¸šåŠ¡é€»è¾‘ for (int i = 0; i \u0026lt; shardTotal; i++) { if (i == shardIndex) { XxlJobHelper.log(\u0026#34;ç¬¬ {} ç‰‡, å‘½ä¸­åˆ†ç‰‡å¼€å§‹å¤„ç†\u0026#34;, i); } else { XxlJobHelper.log(\u0026#34;ç¬¬ {} ç‰‡, å¿½ç•¥\u0026#34;, i); } } } /** * 3ã€å‘½ä»¤è¡Œä»»åŠ¡ */ @XxlJob(\u0026#34;commandJobHandler\u0026#34;) public void commandJobHandler() throws Exception { String command = XxlJobHelper.getJobParam(); int exitValue = -1; BufferedReader bufferedReader = null; try { // command process ProcessBuilder processBuilder = new ProcessBuilder(); processBuilder.command(command); processBuilder.redirectErrorStream(true); Process process = processBuilder.start(); //Process process = Runtime.getRuntime().exec(command); BufferedInputStream bufferedInputStream = new BufferedInputStream(process.getInputStream()); bufferedReader = new BufferedReader(new InputStreamReader(bufferedInputStream)); // command log String line; while ((line = bufferedReader.readLine()) != null) { XxlJobHelper.log(line); } // command exit process.waitFor(); exitValue = process.exitValue(); } catch (Exception e) { XxlJobHelper.log(e); } finally { if (bufferedReader != null) { bufferedReader.close(); } } if (exitValue == 0) { // default success } else { XxlJobHelper.handleFail(\u0026#34;command exit value(\u0026#34;+exitValue+\u0026#34;) is failed\u0026#34;); } } /** * 4ã€è·¨å¹³å°Httpä»»åŠ¡ * å‚æ•°ç¤ºä¾‹ï¼š * \u0026#34;url: http://www.baidu.com\\n\u0026#34; + * \u0026#34;method: get\\n\u0026#34; + * \u0026#34;data: content\\n\u0026#34;; */ @XxlJob(\u0026#34;httpJobHandler\u0026#34;) public void httpJobHandler() throws Exception { // param parse String param = XxlJobHelper.getJobParam(); if (param==null || param.trim().length()==0) { XxlJobHelper.log(\u0026#34;param[\u0026#34;+ param +\u0026#34;] invalid.\u0026#34;); XxlJobHelper.handleFail(); return; } String[] httpParams = param.split(\u0026#34;\\n\u0026#34;); String url = null; String method = null; String data = null; for (String httpParam: httpParams) { if (httpParam.startsWith(\u0026#34;url:\u0026#34;)) { url = httpParam.substring(httpParam.indexOf(\u0026#34;url:\u0026#34;) + 4).trim(); } if (httpParam.startsWith(\u0026#34;method:\u0026#34;)) { method = httpParam.substring(httpParam.indexOf(\u0026#34;method:\u0026#34;) + 7).trim().toUpperCase(); } if (httpParam.startsWith(\u0026#34;data:\u0026#34;)) { data = httpParam.substring(httpParam.indexOf(\u0026#34;data:\u0026#34;) + 5).trim(); } } // param valid if (url==null || url.trim().length()==0) { XxlJobHelper.log(\u0026#34;url[\u0026#34;+ url +\u0026#34;] invalid.\u0026#34;); XxlJobHelper.handleFail(); return; } if (method==null || !Arrays.asList(\u0026#34;GET\u0026#34;, \u0026#34;POST\u0026#34;).contains(method)) { XxlJobHelper.log(\u0026#34;method[\u0026#34;+ method +\u0026#34;] invalid.\u0026#34;); XxlJobHelper.handleFail(); return; } boolean isPostMethod = method.equals(\u0026#34;POST\u0026#34;); // request HttpURLConnection connection = null; BufferedReader bufferedReader = null; try { // connection URL realUrl = new URL(url); connection = (HttpURLConnection) realUrl.openConnection(); // connection setting connection.setRequestMethod(method); connection.setDoOutput(isPostMethod); connection.setDoInput(true); connection.setUseCaches(false); connection.setReadTimeout(5 * 1000); connection.setConnectTimeout(3 * 1000); connection.setRequestProperty(\u0026#34;connection\u0026#34;, \u0026#34;Keep-Alive\u0026#34;); connection.setRequestProperty(\u0026#34;Content-Type\u0026#34;, \u0026#34;application/json;charset=UTF-8\u0026#34;); connection.setRequestProperty(\u0026#34;Accept-Charset\u0026#34;, \u0026#34;application/json;charset=UTF-8\u0026#34;); // do connection connection.connect(); // data if (isPostMethod \u0026amp;\u0026amp; data!=null \u0026amp;\u0026amp; data.trim().length()\u0026gt;0) { DataOutputStream dataOutputStream = new DataOutputStream(connection.getOutputStream()); dataOutputStream.write(data.getBytes(\u0026#34;UTF-8\u0026#34;)); dataOutputStream.flush(); dataOutputStream.close(); } // valid StatusCode int statusCode = connection.getResponseCode(); if (statusCode != 200) { throw new RuntimeException(\u0026#34;Http Request StatusCode(\u0026#34; + statusCode + \u0026#34;) Invalid.\u0026#34;); } // result bufferedReader = new BufferedReader(new InputStreamReader(connection.getInputStream(), \u0026#34;UTF-8\u0026#34;)); StringBuilder result = new StringBuilder(); String line; while ((line = bufferedReader.readLine()) != null) { result.append(line); } String responseMsg = result.toString(); XxlJobHelper.log(responseMsg); return; } catch (Exception e) { XxlJobHelper.log(e); XxlJobHelper.handleFail(); return; } finally { try { if (bufferedReader != null) { bufferedReader.close(); } if (connection != null) { connection.disconnect(); } } catch (Exception e2) { XxlJobHelper.log(e2); } } } /** * 5ã€ç”Ÿå‘½å‘¨æœŸä»»åŠ¡ç¤ºä¾‹ï¼šä»»åŠ¡åˆå§‹åŒ–ä¸é”€æ¯æ—¶ï¼Œæ”¯æŒè‡ªå®šä¹‰ç›¸å…³é€»è¾‘ï¼› */ @XxlJob(value = \u0026#34;demoJobHandler2\u0026#34;, init = \u0026#34;init\u0026#34;, destroy = \u0026#34;destroy\u0026#34;) public void demoJobHandler2() throws Exception { XxlJobHelper.log(\u0026#34;XXL-JOB, Hello World.\u0026#34;); } public void init(){ logger.info(\u0026#34;init\u0026#34;); } public void destroy(){ logger.info(\u0026#34;destroy\u0026#34;); } } æˆ‘ä»¬ç°åœ¨å‚è€ƒç®€å•ç¤ºä¾‹è‡ªå·±ç¼–å†™ä»£ç ï¼Œåœ¨media-serviceä¸‹æ–°å»ºåŒ…com.xuecheng.media.service.jobhandlerï¼Œåœ¨è¯¥åŒ…ä¸‹å®šä¹‰æˆ‘ä»¬çš„ä»»åŠ¡ç±» JAVA package com.xuecheng.media.service.jobhandler; import com.xxl.job.core.handler.annotation.XxlJob; import lombok.extern.slf4j.Slf4j; import org.springframework.stereotype.Component; /** * æµ‹è¯•æ‰§è¡Œå™¨ */ @Slf4j @Component public class SimpleJob { @XxlJob(\u0026#34;testJob\u0026#34;) public void testJob() { log.debug(\u0026#34;å¼€å§‹æ‰§è¡Œ.......\u0026#34;); } } ç„¶åè¿›å…¥è°ƒåº¦ä¸­å¿ƒæ·»åŠ ä»»åŠ¡ï¼Œè¿›å…¥ä»»åŠ¡ç®¡ç†ï¼Œæ–°å¢ä»»åŠ¡ä¿¡æ¯ å…¶ä¸­JobHandlerä¸­å¡«å†™@XxlJobæ³¨è§£ä¸­çš„åç§° éšåå¯åŠ¨ä»»åŠ¡ï¼Œæ§åˆ¶å°å¯ä»¥çœ‹åˆ°æ‰§è¡Œå™¨çš„æ–¹æ³•æ‰§è¡Œ ","date":"2024-05-28T15:44:17+08:00","image":"https://www.xuxueli.com/doc/static/xxl-job/images/xxl-logo.jpg","permalink":"http://localhost:1313/p/xxl-job/","title":"Xxl Job"},{"content":"ğŸ™ƒç¼˜èµ·:\rçœ‹äº†å¤§ä½¬åšå®¢ç•Œé¢ç®€æ´ä¼˜ç¾ ååˆ†ç¾¡æ…•! äºæ˜¯ä¾¿èŠ±è´¹ä¸¤å¹´åŠ(å¤©)çš„æ—¶é—´ ,æˆ‘ä¹Ÿæ¨¡ä»¿äº†å¤§ä½¬çš„åšå®¢.\nğŸŠHugoåšå®¢æ­å»º\rğŸ˜…åœ¨é€”ä¸­æˆ‘æŠŠèƒ½è¸©çš„å‘éƒ½è¸©äº† æœ€åè¿˜æ˜¯å®Œæˆäº†,æœç„¶åšæŒå°±æ˜¯èƒœåˆ©,å“ˆå“ˆå“ˆå“ˆ; åœ¨ç¼–å†™è¿™ä¸ªè¿‡ç¨‹,æˆ‘å‘ç°äº†æˆ‘ä¹‹å‰ç ´è§£Typoraä¸èƒ½ç›´æ¥æ‰“å¼€mdæ–‡ä»¶è¿™ä¸ªç¼ºç‚¹è¶…çº§æ˜æ˜¾!! ä»Šå¤©æ™šä¸Šå°±ç»™åˆ äº†é‡æ–°ä¸‹.\n","date":"2024-05-23T17:24:46+08:00","image":"http://localhost:1313/post/img/wallhaven-o5dj1p.jpg","permalink":"http://localhost:1313/p/%E5%BC%80%E5%A7%8B/","title":"èµ·æº"}]